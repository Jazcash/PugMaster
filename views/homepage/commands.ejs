<%
const formatTime = ms => {
    const stringParts = [];

    let seconds = (ms / 1000) | 0;
    ms -= seconds * 1000;

    let minutes = (seconds / 60) | 0;
    seconds -= minutes * 60;

    let hours = (minutes / 60) | 0;
    minutes -= hours * 60;

    let days = (hours / 24) | 0;
    hours -= days * 24;

    let weeks = (days / 7) | 0;
    days -= weeks * 7;

    const shorten = Math.sign(minutes) + Math.sign(hours) + Math.sign(days) + Math.sign(weeks) + Math.sign(seconds) > 2;

    if (shorten) {
        if (weeks > 0) {
            stringParts.push(`${weeks}w`);
        }

        if (days > 0) {
            stringParts.push(`${days}d`);
        }

        if (hours > 0) {
            stringParts.push(`${hours}h`);
        }

        if (minutes > 0) {
            stringParts.push(`${minutes}m`);
        }
    } else {
        if (weeks > 0) {
            stringParts.push(`${weeks} week${weeks > 1 ? 's' : ''}`);
        }

        if (days > 0) {
            stringParts.push(`${days} day${days > 1 ? 's' : ''}`);
        }

        if (hours > 0) {
            stringParts.push(`${hours} hour${hours > 1 ? 's' : ''}`);
        }

        if (minutes > 0) {
            stringParts.push(`${minutes} minute${minutes > 1 ? 's' : ''}`);
        }

        if (seconds > 0 && stringParts.length < 2) {
            stringParts.push(`${seconds} second${seconds > 1 ? 's' : ''}`);
        }
    }

    return stringParts.join(shorten ? ' ' : ' and ');
}
%>
<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../homepage/partials/head') %>
    <title>Commands</title>
</head>

<body>
    <%- include('../homepage/partials/header', {page: 'commands'}) %>
    <div id="commands" class="commands">
        <div class="box box--centered">
            <div class="box__heading commands-box__heading">Commands</div>
            <div class="box__content">
                <div class="commands-box">
                    <div class="commands-box__categories">
                        <a href="#" class="commands-box__nav" id="pickup-nav">Pickup</a>
                        <a href="#" class="commands-box__nav" id="info-nav">Info</a>
                        <a href="#" class="commands-box__nav" id="admin-nav">Admin</a>
                    </div>
                    <div class="commands-box__content">
                        <div class="commands-box__list" id="command-list">
                            <% commands.forEach((group, index) => { %>
                            <div id="<%- group[0].category %>" class="hidden">
                                <% group.forEach((command, indexCommand) => { %>
                                <a href="#<%- command.cmd %>" id="<%- `${command.cmd}-link` %>"><%= command.cmd %></a>
                                <% }); %>
                            </div>
                            <% }); %>

                        </div>
                        <div class="commands-box__command" id="command-box">
                            <% commands.forEach((group, index) => { 
                                group.forEach((command, indexCommand) => {
                                    const name = command.cmd;
                                    const description = command.desc;
                                    const aliases = command.aliases ? command.aliases.join(' ') : 'None';
                                    let usage = `!${command.cmd} `;
    
                                    if (command.args) {
                                        command.args.forEach(arg => usage += `${arg.name} `);
                                    }
                            %>
                            <div class="command hidden" id="<%- `${command.cmd}-content` %>">

                                <div class="command__title">
                                    <span> <%- name %></span>
                                    <% if (command.defaults) { %>
                                    <div class="command__defaults-button">Defaults</div>
                                    <% } %>

                                </div>
                                <div class="command__content">
                                    <div class="command__content__properties">
                                        <p>Description</p>
                                        <p>Aliases</p>
                                        <p>Usage</p>
                                        <% if (command.args) { 
                                                command.args.forEach(arg => {    
                                            %>
                                        <p><%= arg.name %></p>
                                        <% })} %>
                                    </div>
                                    <div class="command__content__values">
                                        <p><%= description %></p>
                                        <p><%= aliases %></p>
                                        <p><%= usage %></p>
                                        <% if (command.args) { 
                                                command.args.forEach(arg => { 
                                                    let desc;
                                                    switch (arg.desc) {
                                                        case 'ping':
                                                            desc = 'User supplied as ping or user id';
                                                            break;
                                                        case 'time':
                                                            desc = 'Time given as 1m 2h 3d 4w - minutes, hours, days, weeks';
                                                            break;
                                                        case 'time-short':
                                                            desc = 'Time given as 1m 2h 3d - minutes, hours, days';
                                                            break;
                                                        default:
                                                            desc = arg.desc;
                                                    }
                                            %>
                                        <p><%= desc %></p>
                                        <% })} %>
                                    </div>
                                    <% if (command.defaults) { %>
                                    <div class="command__content__defaults hidden">
                                        <% command.defaults.forEach(defaultObj => { 
                                                const name = defaultObj.name;
                                                const desc = defaultObj.desc;
                                                const type = defaultObj.type
                                                const value = type === 'time' ? formatTime(defaultObj.value) : defaultObj.value;

                                                let possibleValues;

                                                switch (type) {
                                                    case 'string':
                                                        possibleValues = defaultObj.possibleValues.join(', ');
                                                        break;
                                                    case 'number':
                                                        possibleValues = `from ${defaultObj.possibleValues.from} to ${defaultObj.possibleValues.to}`;
                                                        break;
                                                    case 'time': 
                                                        possibleValues = `${formatTime(defaultObj.possibleValues.from)} to ${formatTime(defaultObj.possibleValues.to)}`;
                                                }
                                        %>
                                        <div class="command__default">
                                            <h3><%- name %></h3>
                                            <p>Description: <%= desc %></p>
                                            <span>Type: <%- type %></span>
                                            <span>Default Value: <%= value %></span>
                                            <span>Possible values: <%= possibleValues %></span>
                                        </div>
                                        <% }); %>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                            <% }); %>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>

</html>